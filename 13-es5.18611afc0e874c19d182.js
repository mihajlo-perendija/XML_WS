function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var s=n[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{XrNF:function(e,n,t){"use strict";t.r(n),t.d(n,"ChatModule",(function(){return U}));var s,r=t("ofXK"),o=t("3Pt+"),i=t("tyNb"),a=t("fXoL"),c=t("qfBg"),l=t("tk/3"),d=t("lJxs"),u=t("JIr8"),g=t("z6cu"),p=t("AytR").a.API_URL,b=((s=function(){function e(n){_classCallCheck(this,e),this.http=n}return _createClass(e,[{key:"getUserConversations",value:function(e){return this.http.get("".concat(p,"/chat/").concat(e),{observe:"response"}).pipe(Object(d.a)((function(e){return e.body})),Object(u.a)((function(e){return Object(g.a)(e.error.message)})))}},{key:"getMessages",value:function(e){return this.http.get("".concat(p,"/conversation/").concat(e,"/messages"),{observe:"response"}).pipe(Object(d.a)((function(e){return e.body})),Object(u.a)((function(e){return Object(g.a)(e.error.message)})))}},{key:"sendMessage",value:function(e){var n=new l.d({"Content-Type":"application/json"});return this.http.post(p+"/message",e,{headers:n,observe:"response"}).pipe(Object(d.a)((function(e){return e.body})),Object(u.a)((function(e){return Object(g.a)(e.error.message)})))}}]),e}()).\u0275fac=function(e){return new(e||s)(a.fc(l.b))},s.\u0275prov=a.Nb({token:s,factory:s.\u0275fac,providedIn:"root"}),s);function f(e,n){if(1&e){var t=a.Yb();a.Xb(0,"div"),a.Xb(1,"div",1),a.jc("click",(function(){a.Hc(t);var e=n.$implicit;return a.nc().selectConversationFunc(e)})),a.Xb(2,"div",2),a.Xb(3,"span"),a.Qc(4),a.Wb(),a.Wb(),a.Wb(),a.Wb()}if(2&e){var s=n.$implicit;a.Db(4),a.Rc((null==s.user?null:s.user.name)+" "+(null==s.user?null:s.user.surname))}}var v,h=((v=function(){function e(){_classCallCheck(this,e),this.selectConversation=new a.o}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(e){}},{key:"getConversationClass",value:function(e){var n;return e.email===(null===(n=this.selectedUser)||void 0===n?void 0:n.email)}},{key:"selectConversationFunc",value:function(e){this.selectConversation.emit(e)}}]),e}()).\u0275fac=function(e){return new(e||v)},v.\u0275cmp=a.Lb({type:v,selectors:[["app-conversations"]],inputs:{conversations:"conversations",selectedUser:"selectedUser"},outputs:{selectConversation:"selectConversation"},features:[a.Bb],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[1,"conversation",3,"click"],[1,"title-text"]],template:function(e,n){1&e&&a.Oc(0,f,5,1,"div",0),2&e&&a.uc("ngForOf",n.conversations)},directives:[r.m],styles:[".conversation[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr -webkit-max-content;grid-template-columns:1fr max-content;grid-gap:10px;color:#ddd;font-size:1.1rem;border-bottom:1px solid #ddd;padding:20px 20px 20px 15px}.conversation.active[_ngcontent-%COMP%], .conversation[_ngcontent-%COMP%]:hover{background:#585858}.conversation[_ngcontent-%COMP%]:hover{cursor:pointer}.title-text[_ngcontent-%COMP%]{font-weight:700;color:#eee;padding-left:5px;white-space:nowrap;text-overflow:ellipsis}.created-date[_ngcontent-%COMP%]{color:#ddd;font-size:1rem}.conversation-message[_ngcontent-%COMP%]{grid-column:span 2;padding-left:5px;white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis}"]}),v),m=function(e,n){return{"my-message":e,"other-message":n}};function x(e,n){if(1&e&&(a.Xb(0,"div"),a.Xb(1,"div",1),a.Xb(2,"div",2),a.Qc(3),a.Wb(),a.Xb(4,"div"),a.Xb(5,"span",3),a.Qc(6),a.Wb(),a.Xb(7,"span",4),a.Qc(8),a.Wb(),a.Wb(),a.Wb(),a.Wb()),2&e){var t=n.$implicit,s=a.nc();a.Db(1),a.uc("ngClass",a.zc(4,m,s.myMessage(t),!s.myMessage(t))),a.Db(2),a.Rc(t.text),a.Db(3),a.Rc(s.messageSender(t)+" at "),a.Db(2),a.Rc(s.messageTime(t))}}var C,y=((C=function(){function e(n,t){_classCallCheck(this,e),this.userService=n,this.chatService=t}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(e){this.getMessages(this.conversation)}},{key:"getMessages",value:function(e){var n=this;e&&this.chatService.getMessages(e.id).subscribe((function(e){n.messages=e}),(function(e){alert(e)}))}},{key:"myMessage",value:function(e){var n;return e.sender_id===(null===(n=this.userService.getUser())||void 0===n?void 0:n.id)}},{key:"messageTime",value:function(e){return new Date(1e3*e.timestamp).toLocaleString()}},{key:"messageSender",value:function(e){if(e)return e.sender_id===this.userService.getUser().id?this.userService.getUser().name:this.selectedUser.name}}]),e}()).\u0275fac=function(e){return new(e||C)(a.Rb(c.a),a.Rb(b))},C.\u0275cmp=a.Lb({type:C,selectors:[["app-messages"]],inputs:{conversation:"conversation",selectedUser:"selectedUser"},features:[a.Bb],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[1,"message-row",3,"ngClass"],[1,"message-text"],[1,"message-username"],[1,"message-time"]],template:function(e,n){1&e&&a.Oc(0,x,9,7,"div",0),2&e&&a.uc("ngForOf",n.messages)},directives:[r.m,r.k],styles:[".message-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:70%;margin-bottom:20px}.my-message[_ngcontent-%COMP%]{justify-content:end;justify-items:end}.other-message[_ngcontent-%COMP%]{justify-items:start}.message-text[_ngcontent-%COMP%]{padding:9px 14px;font-size:1.3rem;margin-bottom:5px}.message-time[_ngcontent-%COMP%], .message-username[_ngcontent-%COMP%]{font-size:1.1rem;color:#777}.my-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:#e81831;color:#eee;border:1px solid #e81831;border-radius:10px 10px 10px 0}.other-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:#eee;color:#111;border:1px solid #ddd;border-radius:10px 10px 10px 0}"]}),C);function O(e,n){if(1&e&&(a.Xb(0,"span"),a.Qc(1),a.Wb()),2&e){var t=a.nc();a.Db(1),a.Rc((null==t.selectedUser?null:t.selectedUser.name)+" "+(null==t.selectedUser?null:t.selectedUser.surname))}}var M,_,w,k=[{path:"",component:(M=function(){function e(n,t){_classCallCheck(this,e),this.userService=n,this.chatService=t}return _createClass(e,[{key:"ngOnInit",value:function(){this.getConversations()}},{key:"getConversations",value:function(){var e,n=this,t=null===(e=this.userService.getUser())||void 0===e?void 0:e.id;this.chatService.getUserConversations(t).subscribe((function(e){n.converesations=e}),(function(e){alert(e)}))}},{key:"selectConversation",value:function(e){this.selectedConversation=e,this.selectedUser=e.user}},{key:"sendMessage",value:function(){var e=this;if(this.selectedConversation&&this.selectedUser.id&&this.newMessage){var n={conversation_id:this.selectedConversation.id,sender_id:this.userService.getUser().id,receiver_id:this.selectedUser.id,text:this.newMessage,timestamp:(new Date).getTime()/1e3};console.log(n),this.chatService.sendMessage(n).subscribe((function(n){e.selectedConversation=void 0,e.selectedConversation=e.selectedConversation,e.newMessage=""}),(function(e){alert(e)}))}}},{key:"getUserInfo",value:function(){}},{key:"refresh",value:function(){}}]),e}(),M.\u0275fac=function(e){return new(e||M)(a.Rb(c.a),a.Rb(b))},M.\u0275cmp=a.Lb({type:M,selectors:[["app-chat-main"]],decls:15,vars:6,consts:[["id","chat-container"],["id","search-container"],[1,"users-button",3,"click"],["id","conversation-list"],[3,"conversations","selectedUser","selectConversation"],["id","lower-left-container"],["id","chat-title"],[4,"ngIf"],["id","chat-message-list"],[3,"conversation","selectedUser"],["id","chat-form",3,"submit"],["type","text","name","message","placeholder","type a message",2,"width","80%",3,"ngModel","ngModelChange"],["type","submit","value","Send"]],template:function(e,n){1&e&&(a.Xb(0,"div",0),a.Xb(1,"div",1),a.Xb(2,"button",2),a.jc("click",(function(){return n.refresh()})),a.Qc(3,"Refresh"),a.Wb(),a.Wb(),a.Xb(4,"div",3),a.Xb(5,"app-conversations",4),a.jc("selectConversation",(function(e){return n.selectConversation(e)})),a.Wb(),a.Wb(),a.Sb(6,"div",5),a.Xb(7,"div",6),a.Oc(8,O,2,1,"span",7),a.Wb(),a.Xb(9,"div",8),a.Sb(10,"app-messages",9),a.Wb(),a.Xb(11,"form",10),a.jc("submit",(function(){return n.sendMessage()})),a.Xb(12,"div"),a.Xb(13,"input",11),a.jc("ngModelChange",(function(e){return n.newMessage=e})),a.Wb(),a.Sb(14,"input",12),a.Wb(),a.Wb(),a.Wb()),2&e&&(a.Db(5),a.uc("conversations",n.converesations)("selectedUser",n.selectedUser),a.Db(3),a.uc("ngIf",n.selectedUser),a.Db(2),a.uc("conversation",n.selectedConversation)("selectedUser",n.selectedUser),a.Db(3),a.uc("ngModel",n.newMessage))},directives:[h,r.n,y,o.s,o.k,o.l,o.b,o.j,o.m],styles:['#chat-container[_ngcontent-%COMP%]{display:grid;grid:"search-container chat-title" 71px "conversation-list chat-message-list" 1fr "lower-left-container chat-form" 78px/275px 1fr;min-width:800px;max-width:1000px;max-height:800px;width:100%;height:95vh;background:#fff;box-shadow:0 0 1em #222;border-radius:2px;margin-top:20px}#conversation-list[_ngcontent-%COMP%], #lower-left-container[_ngcontent-%COMP%], #search-container[_ngcontent-%COMP%]{background:#e81831}#search-container[_ngcontent-%COMP%]{display:grid;align-items:center;align-content:center;padding:0 20px;grid-area:search-container;border-radius:2px 0 0 0;box-shadow:0 1px 3px -1px rgba(0,0,0,.75);z-index:1}.users-button[_ngcontent-%COMP%]{background:#eee;box-shadow:0 3px 0 0 darken(#e81831,10%);border-radius:2px;border:none;color:#111;cursor:pointer;font-size:2em;line-height:.7em;outline:none;padding:.8em 0}.users-button[_ngcontent-%COMP%]:hover{background:#e81831;text-shadow:0 1px 3px darken(#e81831,30%)}#conversation-list[_ngcontent-%COMP%]{grid-area:conversation-list;overflow-y:scroll}#lower-left-container[_ngcontent-%COMP%]{grid-area:lower-left-container;border-top:1px solid rgba(0,0,0,.25);border-radius:0 0 0 2px;display:grid;padding:0 20px;box-shadow:0 1px 3px -1px rgba(0,0,0,.75);z-index:1}#lower-left-container[_ngcontent-%COMP%], .buttons-div[_ngcontent-%COMP%]{align-items:center;align-content:center}.buttons-div[_ngcontent-%COMP%]{display:inline-block;text-align:center}.button-link[_ngcontent-%COMP%]{display:inline-block;width:80px;background:#eee;box-shadow:0 3px 0 0 darken(#e81831,10%);border-radius:2px;border:none;color:#111;cursor:pointer;font-size:2em;line-height:.7em;outline:none;padding:.8em 0;text-decoration:none}.button-link[_ngcontent-%COMP%]:hover{background:#e81831;text-shadow:0 1px 3px darken(#e81831,30%)}#chat-form[_ngcontent-%COMP%], #chat-title[_ngcontent-%COMP%]{background:#eee}#chat-title[_ngcontent-%COMP%]{display:grid;grid:36px/1fr 36px;align-items:center;align-content:center;grid-area:chat-title;color:#e81831;font-weight:700;font-size:2rem;border-radius:0 2px 0 0;box-shadow:0 1px 3px -1px rgba(0,0,0,.75);padding:0 20px}#chat-message-list[_ngcontent-%COMP%]{grid-area:chat-message-list;display:flex;flex-direction:column-reverse;padding:0 20px;overflow-y:scroll}#chat-form[_ngcontent-%COMP%]{display:grid;grid:51px/1fr;align-content:center;align-items:center;grid-gap:15px;grid-area:chat-form;border-radius:0 0 2px 0;border-top:1px solid rgba(0,0,0,.25);padding-left:42px;padding-right:22px}#chat-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{outline:none;padding:15px;border:2px solid #ddd;color:#330;border-radius:6px;font-size:1.4rem}[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}']}),M),canActivate:[],children:[]},{path:"**",redirectTo:""}],P=((w=function e(){_classCallCheck(this,e)}).\u0275mod=a.Pb({type:w}),w.\u0275inj=a.Ob({factory:function(e){return new(e||w)},imports:[[i.g.forChild(k)],i.g]}),w),U=((_=function e(){_classCallCheck(this,e)}).\u0275mod=a.Pb({type:_}),_.\u0275inj=a.Ob({factory:function(e){return new(e||_)},imports:[[r.c,o.f,P]]}),_)}}]);