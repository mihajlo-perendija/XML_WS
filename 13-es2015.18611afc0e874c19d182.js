(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{XrNF:function(e,t,n){"use strict";n.r(t),n.d(t,"ChatModule",(function(){return M}));var s=n("ofXK"),r=n("3Pt+"),o=n("tyNb"),i=n("fXoL"),c=n("qfBg"),a=n("tk/3"),d=n("lJxs"),l=n("JIr8"),g=n("z6cu");const p=n("AytR").a.API_URL;let b=(()=>{class e{constructor(e){this.http=e}getUserConversations(e){return this.http.get(`${p}/chat/${e}`,{observe:"response"}).pipe(Object(d.a)(e=>e.body),Object(l.a)(e=>Object(g.a)(e.error.message)))}getMessages(e){return this.http.get(`${p}/conversation/${e}/messages`,{observe:"response"}).pipe(Object(d.a)(e=>e.body),Object(l.a)(e=>Object(g.a)(e.error.message)))}sendMessage(e){let t=new a.d({"Content-Type":"application/json"});return this.http.post(p+"/message",e,{headers:t,observe:"response"}).pipe(Object(d.a)(e=>e.body),Object(l.a)(e=>Object(g.a)(e.error.message)))}}return e.\u0275fac=function(t){return new(t||e)(i.fc(a.b))},e.\u0275prov=i.Nb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function u(e,t){if(1&e){const e=i.Yb();i.Xb(0,"div"),i.Xb(1,"div",1),i.jc("click",(function(){i.Hc(e);const n=t.$implicit;return i.nc().selectConversationFunc(n)})),i.Xb(2,"div",2),i.Xb(3,"span"),i.Qc(4),i.Wb(),i.Wb(),i.Wb(),i.Wb()}if(2&e){const e=t.$implicit;i.Db(4),i.Rc((null==e.user?null:e.user.name)+" "+(null==e.user?null:e.user.surname))}}let m=(()=>{class e{constructor(){this.selectConversation=new i.o}ngOnInit(){}ngOnChanges(e){}getConversationClass(e){var t;return e.email===(null===(t=this.selectedUser)||void 0===t?void 0:t.email)}selectConversationFunc(e){this.selectConversation.emit(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Lb({type:e,selectors:[["app-conversations"]],inputs:{conversations:"conversations",selectedUser:"selectedUser"},outputs:{selectConversation:"selectConversation"},features:[i.Bb],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[1,"conversation",3,"click"],[1,"title-text"]],template:function(e,t){1&e&&i.Oc(0,u,5,1,"div",0),2&e&&i.uc("ngForOf",t.conversations)},directives:[s.m],styles:[".conversation[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr -webkit-max-content;grid-template-columns:1fr max-content;grid-gap:10px;color:#ddd;font-size:1.1rem;border-bottom:1px solid #ddd;padding:20px 20px 20px 15px}.conversation.active[_ngcontent-%COMP%], .conversation[_ngcontent-%COMP%]:hover{background:#585858}.conversation[_ngcontent-%COMP%]:hover{cursor:pointer}.title-text[_ngcontent-%COMP%]{font-weight:700;color:#eee;padding-left:5px;white-space:nowrap;text-overflow:ellipsis}.created-date[_ngcontent-%COMP%]{color:#ddd;font-size:1rem}.conversation-message[_ngcontent-%COMP%]{grid-column:span 2;padding-left:5px;white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis}"]}),e})();const h=function(e,t){return{"my-message":e,"other-message":t}};function v(e,t){if(1&e&&(i.Xb(0,"div"),i.Xb(1,"div",1),i.Xb(2,"div",2),i.Qc(3),i.Wb(),i.Xb(4,"div"),i.Xb(5,"span",3),i.Qc(6),i.Wb(),i.Xb(7,"span",4),i.Qc(8),i.Wb(),i.Wb(),i.Wb(),i.Wb()),2&e){const e=t.$implicit,n=i.nc();i.Db(1),i.uc("ngClass",i.zc(4,h,n.myMessage(e),!n.myMessage(e))),i.Db(2),i.Rc(e.text),i.Db(3),i.Rc(n.messageSender(e)+" at "),i.Db(2),i.Rc(n.messageTime(e))}}let f=(()=>{class e{constructor(e,t){this.userService=e,this.chatService=t}ngOnInit(){}ngOnChanges(e){this.getMessages(this.conversation)}getMessages(e){e&&this.chatService.getMessages(e.id).subscribe(e=>{this.messages=e},e=>{alert(e)})}myMessage(e){var t;return e.sender_id===(null===(t=this.userService.getUser())||void 0===t?void 0:t.id)}messageTime(e){return new Date(1e3*e.timestamp).toLocaleString()}messageSender(e){if(e)return e.sender_id===this.userService.getUser().id?this.userService.getUser().name:this.selectedUser.name}}return e.\u0275fac=function(t){return new(t||e)(i.Rb(c.a),i.Rb(b))},e.\u0275cmp=i.Lb({type:e,selectors:[["app-messages"]],inputs:{conversation:"conversation",selectedUser:"selectedUser"},features:[i.Bb],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[1,"message-row",3,"ngClass"],[1,"message-text"],[1,"message-username"],[1,"message-time"]],template:function(e,t){1&e&&i.Oc(0,v,9,7,"div",0),2&e&&i.uc("ngForOf",t.messages)},directives:[s.m,s.k],styles:[".message-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:70%;margin-bottom:20px}.my-message[_ngcontent-%COMP%]{justify-content:end;justify-items:end}.other-message[_ngcontent-%COMP%]{justify-items:start}.message-text[_ngcontent-%COMP%]{padding:9px 14px;font-size:1.3rem;margin-bottom:5px}.message-time[_ngcontent-%COMP%], .message-username[_ngcontent-%COMP%]{font-size:1.1rem;color:#777}.my-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:#e81831;color:#eee;border:1px solid #e81831;border-radius:10px 10px 10px 0}.other-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:#eee;color:#111;border:1px solid #ddd;border-radius:10px 10px 10px 0}"]}),e})();function x(e,t){if(1&e&&(i.Xb(0,"span"),i.Qc(1),i.Wb()),2&e){const e=i.nc();i.Db(1),i.Rc((null==e.selectedUser?null:e.selectedUser.name)+" "+(null==e.selectedUser?null:e.selectedUser.surname))}}const C=[{path:"",component:(()=>{class e{constructor(e,t){this.userService=e,this.chatService=t}ngOnInit(){this.getConversations()}getConversations(){var e;const t=null===(e=this.userService.getUser())||void 0===e?void 0:e.id;this.chatService.getUserConversations(t).subscribe(e=>{this.converesations=e},e=>{alert(e)})}selectConversation(e){this.selectedConversation=e,this.selectedUser=e.user}sendMessage(){if(this.selectedConversation&&this.selectedUser.id&&this.newMessage){var e={conversation_id:this.selectedConversation.id,sender_id:this.userService.getUser().id,receiver_id:this.selectedUser.id,text:this.newMessage,timestamp:(new Date).getTime()/1e3};console.log(e),this.chatService.sendMessage(e).subscribe(e=>{this.selectedConversation=void 0,this.selectedConversation=this.selectedConversation,this.newMessage=""},e=>{alert(e)})}}getUserInfo(){}refresh(){}}return e.\u0275fac=function(t){return new(t||e)(i.Rb(c.a),i.Rb(b))},e.\u0275cmp=i.Lb({type:e,selectors:[["app-chat-main"]],decls:15,vars:6,consts:[["id","chat-container"],["id","search-container"],[1,"users-button",3,"click"],["id","conversation-list"],[3,"conversations","selectedUser","selectConversation"],["id","lower-left-container"],["id","chat-title"],[4,"ngIf"],["id","chat-message-list"],[3,"conversation","selectedUser"],["id","chat-form",3,"submit"],["type","text","name","message","placeholder","type a message",2,"width","80%",3,"ngModel","ngModelChange"],["type","submit","value","Send"]],template:function(e,t){1&e&&(i.Xb(0,"div",0),i.Xb(1,"div",1),i.Xb(2,"button",2),i.jc("click",(function(){return t.refresh()})),i.Qc(3,"Refresh"),i.Wb(),i.Wb(),i.Xb(4,"div",3),i.Xb(5,"app-conversations",4),i.jc("selectConversation",(function(e){return t.selectConversation(e)})),i.Wb(),i.Wb(),i.Sb(6,"div",5),i.Xb(7,"div",6),i.Oc(8,x,2,1,"span",7),i.Wb(),i.Xb(9,"div",8),i.Sb(10,"app-messages",9),i.Wb(),i.Xb(11,"form",10),i.jc("submit",(function(){return t.sendMessage()})),i.Xb(12,"div"),i.Xb(13,"input",11),i.jc("ngModelChange",(function(e){return t.newMessage=e})),i.Wb(),i.Sb(14,"input",12),i.Wb(),i.Wb(),i.Wb()),2&e&&(i.Db(5),i.uc("conversations",t.converesations)("selectedUser",t.selectedUser),i.Db(3),i.uc("ngIf",t.selectedUser),i.Db(2),i.uc("conversation",t.selectedConversation)("selectedUser",t.selectedUser),i.Db(3),i.uc("ngModel",t.newMessage))},directives:[m,s.n,f,r.s,r.k,r.l,r.b,r.j,r.m],styles:['#chat-container[_ngcontent-%COMP%]{display:grid;grid:"search-container chat-title" 71px "conversation-list chat-message-list" 1fr "lower-left-container chat-form" 78px/275px 1fr;min-width:800px;max-width:1000px;max-height:800px;width:100%;height:95vh;background:#fff;box-shadow:0 0 1em #222;border-radius:2px;margin-top:20px}#conversation-list[_ngcontent-%COMP%], #lower-left-container[_ngcontent-%COMP%], #search-container[_ngcontent-%COMP%]{background:#e81831}#search-container[_ngcontent-%COMP%]{display:grid;align-items:center;align-content:center;padding:0 20px;grid-area:search-container;border-radius:2px 0 0 0;box-shadow:0 1px 3px -1px rgba(0,0,0,.75);z-index:1}.users-button[_ngcontent-%COMP%]{background:#eee;box-shadow:0 3px 0 0 darken(#e81831,10%);border-radius:2px;border:none;color:#111;cursor:pointer;font-size:2em;line-height:.7em;outline:none;padding:.8em 0}.users-button[_ngcontent-%COMP%]:hover{background:#e81831;text-shadow:0 1px 3px darken(#e81831,30%)}#conversation-list[_ngcontent-%COMP%]{grid-area:conversation-list;overflow-y:scroll}#lower-left-container[_ngcontent-%COMP%]{grid-area:lower-left-container;border-top:1px solid rgba(0,0,0,.25);border-radius:0 0 0 2px;display:grid;padding:0 20px;box-shadow:0 1px 3px -1px rgba(0,0,0,.75);z-index:1}#lower-left-container[_ngcontent-%COMP%], .buttons-div[_ngcontent-%COMP%]{align-items:center;align-content:center}.buttons-div[_ngcontent-%COMP%]{display:inline-block;text-align:center}.button-link[_ngcontent-%COMP%]{display:inline-block;width:80px;background:#eee;box-shadow:0 3px 0 0 darken(#e81831,10%);border-radius:2px;border:none;color:#111;cursor:pointer;font-size:2em;line-height:.7em;outline:none;padding:.8em 0;text-decoration:none}.button-link[_ngcontent-%COMP%]:hover{background:#e81831;text-shadow:0 1px 3px darken(#e81831,30%)}#chat-form[_ngcontent-%COMP%], #chat-title[_ngcontent-%COMP%]{background:#eee}#chat-title[_ngcontent-%COMP%]{display:grid;grid:36px/1fr 36px;align-items:center;align-content:center;grid-area:chat-title;color:#e81831;font-weight:700;font-size:2rem;border-radius:0 2px 0 0;box-shadow:0 1px 3px -1px rgba(0,0,0,.75);padding:0 20px}#chat-message-list[_ngcontent-%COMP%]{grid-area:chat-message-list;display:flex;flex-direction:column-reverse;padding:0 20px;overflow-y:scroll}#chat-form[_ngcontent-%COMP%]{display:grid;grid:51px/1fr;align-content:center;align-items:center;grid-gap:15px;grid-area:chat-form;border-radius:0 0 2px 0;border-top:1px solid rgba(0,0,0,.25);padding-left:42px;padding-right:22px}#chat-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{outline:none;padding:15px;border:2px solid #ddd;color:#330;border-radius:6px;font-size:1.4rem}[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}']}),e})(),canActivate:[],children:[]},{path:"**",redirectTo:""}];let O=(()=>{class e{}return e.\u0275mod=i.Pb({type:e}),e.\u0275inj=i.Ob({factory:function(t){return new(t||e)},imports:[[o.g.forChild(C)],o.g]}),e})(),M=(()=>{class e{}return e.\u0275mod=i.Pb({type:e}),e.\u0275inj=i.Ob({factory:function(t){return new(t||e)},imports:[[s.c,r.f,O]]}),e})()}}]);